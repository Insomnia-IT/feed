# Поиск дубликатов при загрузке списка

ID: 72
Status: Есть Постановка
Blocked by: Загрузка списком из Google Spreadsheet (%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%BE%D0%BC%20%D0%B8%D0%B7%20Google%20Spreadsheet%206a8869570d5545949e529bce6268c389.md)
Parent task: Загрузка списком из Google Spreadsheet (%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%BE%D0%BC%20%D0%B8%D0%B7%20Google%20Spreadsheet%206a8869570d5545949e529bce6268c389.md)

При загрузке списка из Google Spreadsheet для каждой загружаемой строки должен выполняться поиск по базе данных записей с совпадающими фамилией и именем.

Сначала выполняется поиск по таблице Бейджей. Если находятся совпадения, то

- запись не импортируется,
- в таблице в графе “Бейдж” добавляется ссылка на найденные карточки в ноушен,
- ячейка “бейдж” красится в желтый цвет
- также в желтый красятся ячейки, для которых значения в таблице гугла и в БД различаются

Во вторую очередь выполняется поиск по таблице Человеков.

- создаваемая запись Бейджа привязывается к указанному Человеку,
- в таблице в графе “Карточка волонтёра” добавляется ссылка на карточку в ноушен

Если на момент проведения загрузки в ячейке “Бейдж” указано ключевое слово “new”, то поиск не выполняется, а просто создаётся новый бейдж (для кейса полных тезок).

Если в ячейке “Бейдж” заранее указана ссылка на карточку (одна), то выполняется обновление записи бейджа в БД по данным таблицы. Если имеющийся в БД бейдж привязан к другому направлению, то в него добавляется новая привязка (старая сохраняется).

Если в ячейке “Карточка волонтёра” указана ссылка, то не выполняется поиск по базе Человеков, а используется запись, на которую ссылается (перед этим выполняется сверка фамилии и имени, и при несовпадении ячейка красится в красный).

Если в процессе импорта в ячейках обнаруживаются данные, которые невозможно интерпретировать, то ячейки красятся в красный.

При импорте обращать внимание на роль. Если роль из зеленых либо синих, то обязательным становятся также поле телеграм либо телефон. А также при этом создаётся также запись “Человека” и Участия на этот год.

При успешном создании записи Бейджа и/или Человека ссылка на созданную карточку в ноушен добавляется в соответствующую ячейку, и ячейка красится в зеленый цвет.