# Карта

Основная идея - карта как рисунок удобной спутниковой. Красивую карту не делаем вторым слоем, и не даем возможность скачать в pdf. На карте отметки локаций. При нажатии на локацию можно увидеть расписание и/или меню. Есть расписание с добавлением аудиторий и без.

**Интеграция с Notion:**

- **Интеграция с Notion:**
    
    Координаты забираем с Google Maps. В мае происходит выезд замерщиков и участников на поляну, где финализируют расположение локаций (кроме туалетов и столбов - их координаты уточняются обычно на месте)
    
     [Google Maps по факту замера 2023](https://www.google.com/maps/d/u/0/viewer?ll=54.68343598557146%2C35.07809450000001&z=13&mid=1sD1RI70-cZcGajPZtFgQCVYw2Y74w2w)
    
    В Notion есть ежегодная таблица с списком локаций. Ее заполняют ответственные от локаций и ответственный за все локации. Данные о локациях из этой таблицы мы получаем через апи агримода. Интеграцию делает [Ashedu](https://t.me/Ashedu).
    
    Вот здесь лежит [Список локаций](https://docs.google.com/spreadsheets/d/18U2oxdwE6Lc634MwOXok3p8x59wylAxo2ZVNVApchg4/edit?pli=1#gid=1082430603), права редактора даю по запросу @heloiise. Иконки, размеры на карте и directionid определены в ней.
    
    [**Локации 2023](https://www.notion.so/ea246f2445574f2c8815036b3f4cf12b?pvs=21) в ноушене бессонницы**
    
    [ТЗ на интеграцию 2022](https://github.com/Insomnia-IT/Wiki/blob/main/aggremod/tz_for_new_aggremod.md)
    
    [**ТЗ на интеграцию](https://docs.google.com/document/d/1Sj9ejnGo7NzjdNSah1_P_3lflLdTtLj9IwLXERsfXdg/edit#heading=h.1yra9ellk8yq) новое 2023**
    
    [Пример выгрузки](https://docs.google.com/spreadsheets/d/1IXCvuF0kPVIeEPBrk8eXJ_3iTWCW5RRUI7wgBvEq31Y/edit?usp=sharing) 
    
    - **Локации 2022 (для примера)**
        - **Внутренние**
            - Админка.Кухня
            - Админка.МТС (Верстак)
            - Админка.Штаб
            - Админка.Штаб строяка и хозпалатка
            - Админка.Электрохауз(Электрики)
            - Домик полиции
            - КПП-1
            - Парковка, КПП-2
            - ЦУЭ 1
            - ЦУЭ 2
            - ЦУЭ детская
            - Сокровищница Хатифнаттов + лагерь Хатифнаттов
            - АниматорSKYя (для аниматоров)
            - Хэдлайнер (ЛАГЕРЬ)
        - **Для посетителей**
            - Арт-объект “Х”
            - Баня Steamology
            - Баня Лимонов
            - Ветер в Кронах (детское)
            - Витражи (сцена/кафе)
            - Высотные качели (качели)
            - Галерея (выставка + аукцион)
            - Детская площадка
            - Детское кафе “Глаз да глаз”
            - Диафильминариум (пространство-кинозал)
            - Души (на согласовании)
            - Инфоцентр
            - Карусель “Заря” (карусель/кафе)
            - Кафе "Рагнарок"
            - Кафе “Guzzler Bird”
            - Кафе “Катавасия”
            - Кафе “Кинобар”
            - Кафе “Ништя4ная”
            - Кафе “ЭльСтэйко”
            - Кафе-библиотека “Locus Solus”
            - Лаборатория (лаборатория/лекции/мастер-классы)
            - Музыкальная сцена
            - Общий костёр
            - Фудкорт
            - Огненный торнадо
            - Прокат палаток
            - Свадебная локация
            - Фудкорт (фудкорт с бэкстейджем)
            - Экран 1
            - Экран 2
            - Экран Детской
            - Ярмарка “Лесная”(ярмарка + лагерь ярмарочников)
            - Ярмарка “Полевая”(только ярмарка)
            - Ярмарка “Речная”(ярмарка + лагерь ярмарочников)
            - Шатер “Мастер-классы” на Ярмарке
            - Шатёр “VR”
            - Шатёр “Анимации”
            - Шатёр “Мастер-классы”
            - Шатёр “Хаттифнариум”
            - Медпункт
            - Накрывашка “Боевые сказочники”
            - Накрывашка “Пси-поляна”
            - Накрывашка “Телесные практики”
            - Накрывашка “Фъюжн”
            - Точка сборки (потерянные дети и взрослые от Лиза Алерт)
            - Арт-объект “Самолет”
            - Арт-объект “Корабль”
        - **Лагеря посетителей**
            - Лесной лагерь “Байка”
            - Лесной лагерь “Тише мыши” (лагерь “У детской площадки” — это официальное название, именно в него продаются билеты)
            - Палаточный отель “Караван”
            - Юрты
            - платный Автолагерь
        - **Туалеты (много)**
    
- **Поиск**
    
    Названия локаций в поиске ищутся по слову из названия, полному названию или части слов, или части любого слова от 3х букв
    
    [**Поисковые запросы**](https://docs.google.com/spreadsheets/d/1bwlBZXK4JxFl_8ESf43xa8vU5OG_yzNUhVDPNNmWBSc/edit#gid=224902105)
    

Смотри [Список локаций](https://docs.google.com/spreadsheets/d/18U2oxdwE6Lc634MwOXok3p8x59wylAxo2ZVNVApchg4/edit?pli=1#gid=1082430603), там запросы

## Таблица - выгрузка с фронта

Ниже представлена таблица, составленная на основе кода с фронта. 

`OrderType` - определяет порядок и размеры отображения на карте

`Icon` - определяет отображаемую иконку

`Detail` - определяет общий порядок отрисовки деталки локации

[Соответствия](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20c887db9c58b646df9a3df94eb6727b77/%D0%A1%D0%BE%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D1%81%D1%82%D0%B2%D0%B8%D1%8F%2068e94dff54db41309e9d6e012ae533e8.csv)

## Icons

Иконки из таблицы

![Untitled](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20c887db9c58b646df9a3df94eb6727b77/Untitled.png)

[https://www.figma.com/file/B63Uo9hXGuKuquxBLVUCDs/insomnia-2023?type=design&node-id=3955-31822&t=CUmJ3jqIGGBnF02M-4](https://www.figma.com/file/B63Uo9hXGuKuquxBLVUCDs/insomnia-2023?type=design&node-id=3955-31822&t=CUmJ3jqIGGBnF02M-4)

На картинке подписаны только те иконки, к которым указано соответствие выше в таблице соответствий

## Деталки

Модель Location из Базы

```tsx
type InsomniaLocation = {
  _id: string;
  notionId: string;
  name: string;
  description: string;
  directionId: string;
  figure: Geo | Geo[][];
  tags: string[];
  menu?: string;
  work_tags?: string[];
};

type Geo = { lat: number; lon: number };
```

Модель Location из Интерфейса (Желаемая модель)

```tsx
type InsomniaLocation = {
  _id: string;
  notionId: string;
  name: string;
  description: string;
  directionId: string;
  figure: Geo | Geo[][];
  tags: string[];
  menu?: string;
  minZoom?: number;
  maxZoom?: number;
  contentBlocks?: ContentBlock[];
};

type Geo = { lat: number; lon: number };

type ContentBlock = {
  blockType: 'link' | 'text' | 'list';
  content: string | ListItem[];
}

type ListItem = {
  tag?: string;
  title: string;
  description: string;
}
```

По умолчанию все деталки локаций под заголовком содержат описание, которое для каждой локации можно брать из поля `description`. (сейчас у всех локаций это поле пустое ***`TODO**: найти и заполнить информацию`*)

Судя по дизайнам внутри деталок может быть либо **текстовый блок**, либо **ссылка**, либо **список**

Текстовый блок

![Untitled](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20c887db9c58b646df9a3df94eb6727b77/Untitled%201.png)

Ссылка

![Untitled](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20c887db9c58b646df9a3df94eb6727b77/Untitled%202.png)

Список

![Untitled](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20c887db9c58b646df9a3df94eb6727b77/Untitled%203.png)

Админка деталок локаций предполагает наполнение контентом. В таком случае необходимо обновить модель хранения `InsomniaLocation` внутри базы, чтоб иметь возможность заполнять `ContentBlock`

На данный момент динамически определять контент для деталки предполагается на основе `directionId`. В [таблице](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20c887db9c58b646df9a3df94eb6727b77/%D0%A1%D0%BE%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D1%81%D1%82%D0%B2%D0%B8%D1%8F%2068e94dff54db41309e9d6e012ae533e8.md) выше определено соответствие `directionId` и `DetailsGroup`

| **`DetailsGroup`** | Текст | Ссылки | Список | Примечание |
| --- | --- | --- | --- | --- |
| cafe | description | ссылка на меню | Меню |  |
| shop | description | Ссылка на список | Список |  |
| screen | description | к расписанию |  | есть блок что идет. Смотрим в `animationStore` |
| music | description | к расписанию |  | Уточнить ??? |
| activity | description | к расписанию
подробнее про хатифнатов (**Хатифнариум**)
к детской площадке (**Диафильминариум**)
я с ребенком (**Детская поляна / Мастер-классы**) |  | есть блок что идет. Смотрим в `activityStore`  |
| tent | description | правила кемпинга
про экологию и мусор |  |  |
| wc | description |  |  | есть время работы! |
| art | description |  |  | есть время работы! |
| info | description | к разделам |  |  |
| point | description | я потерял ребенка
я потерял взрослого
я потерял животное
я потерял вещь |  |  |
| med | description | я поранился
как помочь раненому
про клещей |  |  |
| other | description |  |  |  |